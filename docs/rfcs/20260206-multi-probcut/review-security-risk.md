## Security & Risk Reviewer によるレビュー結果

### 1. 判定 (Decision)

- **Status**: Approve

**判定基準:** P0 が1件以上存在する場合は Request Changes とする。P0 が0件の場合は Approve とする。

### 2. 良い点 (Strengths)

- **後方互換性 (Section 7.3)**: `UseMultiProbCut = false` のデフォルト値により、既存の呼び出し元への影響がゼロである点が明確に保証されている。
- **MPC 再帰防止 (Section 5.4.3)**: `_mpcEnabled` フラグによる再帰防止メカニズムが設計段階で考慮されており、無限再帰やスタックオーバーフローのリスクが排除されている。
- **段階的導入 (Section 9)**: 4 フェーズに分割された実装計画により、各フェーズの完了時点で品質を検証でき、問題発生時のロールバック範囲が限定される。
- **パス直後ノードの除外 (Section 5.4.1)**: `isPassed == true` 時に MPC を適用しない判断は、局面性質の急変によるカット判定の誤りを防ぐ適切なリスク緩和である。

### 3. 指摘事項 (Issues)

#### Severity 定義

| Severity | 名称 | 定義 | Author の対応 |
| :--- | :--- | :--- | :--- |
| **P0 (Blocker)** | 修正必須 | 論理的欠陥、仕様漏れ、重大なリスク、回答必須の質問 | 必ず対応 |
| **P1 (Improvement)** | 具体的改善 | 修正内容と期待効果が明確な具体的改善提案 | 原則対応 |
| **P2 (Note)** | 記録のみ | 代替案の提示、将来的な懸念、参考情報 | 対応不要 |

#### 指摘一覧

**P0**: 該当なし

**[P1-1] _mpcEnabled フラグのスレッドセーフティに関するリスク注記の欠如**
- **対象セクション**: 5.4.3 MPC 用フラグの管理
- **内容**: `_mpcEnabled` はインスタンスフィールドとして管理されるが、`PvsSearchEngine` が将来的に並列探索で共有された場合、フラグの save/restore がスレッドセーフでなくなるリスクがある。現時点では Non-Goals に「並列探索との統合」が記載されているが、このフラグ設計がシングルスレッド前提であることを明示していない。
- **修正の期待値**: Section 5.4.3 に「本設計はシングルスレッド前提である。並列探索の導入時には `_mpcEnabled` の管理方式をスレッドローカルまたは引数渡しに変更する必要がある」旨の注記を追加すること。

**[P1-2] 浅い探索でフルウィンドウを使用する際の探索爆発リスク**
- **対象セクション**: 5.4.4 浅い探索の窓幅
- **内容**: MPC 用の浅い探索でフルウィンドウ（`DefaultAlpha`, `DefaultBeta`）を使用するとされている。浅い探索内では MPC は無効化されるが、TT は活用される。しかし、反復深化の初期段階で TT が十分に蓄積されていない場合、フルウィンドウの浅い探索が想定以上のノードを展開するリスクがある。
- **修正の期待値**: Section 7.1 のパフォーマンス考察に、フルウィンドウ浅い探索の最悪ケースにおけるノード数の見積もりを追記すること。例えば「Pair 1 (d'=2) の場合、フルウィンドウ探索のノード数は最大約 100（分岐係数 10^2）であり、深い探索（d=6, 最大 10^6 ノード）のカットによる削減効果に対して十分小さい」等の定量的な根拠を示すこと。

**[P2-1] 浮動小数点演算の丸め誤差によるカット判定への影響**
- **対象セクション**: 5.4.2 TryMultiProbCut メソッド
- **内容**: 閾値計算で `Math.Ceiling` / `Math.Floor` を使用して `long` にキャストしているが、浮動小数点演算の丸め誤差が境界値付近でカット判定を変える可能性がある。オセロ探索エンジンという性質上、セキュリティ上の脆弱性にはならないが、カット判定の一貫性に影響しうる。将来のデバッグ時に留意すべき事項として記録する。
