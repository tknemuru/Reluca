## Security & Risk Reviewer によるレビュー結果

### 1. 判定 (Decision)

- **Status**: Approve

**判定基準:** P0 が1件以上存在する場合は Request Changes とする。P0 が0件の場合は Approve とする。

### 2. 良い点 (Strengths)

- **後方互換性の確保**: `UseMultiProbCut = false` がデフォルトであり、既存の動作に一切影響を与えない安全な設計である。
- **フラグの save/restore パターン**: `_mpcEnabled` と `_suppressTTStore` の退避・復元が正しく実装されており、MPC 浅い探索後に状態が確実に復元される。
- **null 安全性**: `GetParameters()` の戻り値が null チェックされており、範囲外のステージ・カットペアインデックスに対して安全に動作する。
- **エラーハンドリング**: MPC 判定でカットが成立しない場合は `null` を返し、通常の探索フローに確実にフォールバックする設計である。
- **浮動小数点演算の安全性**: 閾値計算で `Math.Ceiling` / `Math.Floor` を使用し、浮動小数点の丸め誤差による誤カットを防止している。

### 3. 指摘事項 (Issues)

#### Severity 定義

| Severity | 名称 | 定義 | Author の対応 |
| :--- | :--- | :--- | :--- |
| **P0 (Blocker)** | 修正必須 | 論理的欠陥、仕様漏れ、重大なリスク、回答必須の質問 | 必ず対応 |
| **P1 (Improvement)** | 具体的改善 | 修正内容と期待効果が明確な具体的改善提案 | 原則対応 |
| **P2 (Note)** | 記録のみ | 代替案の提示、将来的な懸念、参考情報 | 対応不要 |

#### 指摘一覧

**P0:** 該当なし

**P1:** 該当なし

**[P2-1] シングルスレッド前提の save/restore パターンのリスク記録**
- **対象セクション**: 5.4.3 MPC 用フラグの管理
- **内容**: `_mpcEnabled` と `_suppressTTStore` の save/restore パターンはシングルスレッド前提で正しく動作するが、将来の並列探索導入時にはスレッドセーフティの問題が発生する。RFC 内の注記（Section 5.4.3）で明記されており、現時点では対応不要であるが、並列探索 RFC 着手時にフラグ管理方式の変更が必須となる点を記録する。

**[P2-2] DefaultAlpha/DefaultBeta を用いた浅い探索のオーバーフローリスク**
- **対象セクション**: 5.4.5 浅い探索の窓幅
- **内容**: `TryMultiProbCut` 内の浅い探索で `DefaultAlpha` / `DefaultBeta`（約 +/-10^18）をフルウィンドウとして使用している。閾値計算で `(double)beta` のキャストにより `long` から `double` への変換が発生するが、`DefaultBeta` の値（10^18 + 1）は `double` の精度範囲内（53 ビット仮数部で約 9 * 10^15 まで正確）を超えている。ただし、実際の探索では beta が `DefaultBeta` のままカット判定に到達するケースは極めて稀であり（TT Probe やウィンドウ縮小が先行するため）、実害は低いと判断する。
