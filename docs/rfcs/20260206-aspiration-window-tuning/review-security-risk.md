## Security & Risk Reviewer によるレビュー結果

### 1. 判定 (Decision)

- **Status**: Approve

**判定基準:** P0 が1件以上存在する場合は Request Changes とする。P0 が0件の場合は Approve とする。

### 2. 良い点 (Strengths)

- **Section 7.3 (マイグレーションと後方互換性)**: `AspirationUseStageTable = false` をデフォルトとし、既存の呼び出し元に変更を要求しない設計は後方互換性の観点から適切である。
- **Section 9 (リスク軽減策)**: フラグによる即時ロールバックが可能な設計であり、問題発生時の対応が明確に示されている。
- **Section 5.7 (PvsSearchEngine の変更)**: `MaxDelta` による delta のクランプ処理がオーバーフロー防止として正しく設計されている。
- **Section 5.5 (retry 計測機能)**: パラメータチューニングの判断材料を定量的に収集する仕組みが設計に組み込まれており、リスクの早期検出が可能である。

### 3. 指摘事項 (Issues)

#### Severity 定義

| Severity | 名称 | 定義 | Author の対応 |
| :--- | :--- | :--- | :--- |
| **P0 (Blocker)** | 修正必須 | 論理的欠陥、仕様漏れ、重大なリスク、回答必須の質問 | 必ず対応 |
| **P1 (Improvement)** | 具体的改善 | 修正内容と期待効果が明確な具体的改善提案 | 原則対応 |
| **P2 (Note)** | 記録のみ | 代替案の提示、将来的な懸念、参考情報 | 対応不要 |

#### 指摘一覧

**P0**: 該当なし

**[P1-1] 指数拡張における delta オーバーフローの境界条件**
- **対象セクション**: Section 5.3.1 (指数拡張戦略の導入)
- **内容**: `delta * (1L << (retryCount + 1))` の計算において、`1L << (retryCount + 1)` は retryCount = 2 で 8 となるが、delta が大きい場合（例: 序盤 delta = 160（baseDelta 80 * depthFactor 2.0））に `160 * 8 = 1280` となり、`MaxDelta` でクランプされる前の中間計算で long の範囲を超えることはない。ただし、将来的に delta の初期値や拡張倍率が変更された場合に備え、乗算前のオーバーフローチェックを追加すると安全性が向上する。
- **修正の期待値**: `Math.Min(delta * (1L << (retryCount + 1)), MaxDelta)` の乗算でオーバーフローが発生しないことを保証するため、`checked` ブロックまたは事前チェックの追加を検討すること。

**[P1-2] フェーズ 3 ベンチマークの失敗基準の明確化**
- **対象セクション**: Section 9 (実装・リリース計画)
- **内容**: フェーズ 3 のベンチマークで「NodesSearched が改善すること」が目標として記載されているが、改善が得られなかった場合の判断基準と対応方針が明示されていない。改善が得られず悪化した場合に、RFC 自体を中止するのか、パラメータのみリバートして指数拡張戦略は維持するのか、判断基準を定めるべきである。
- **修正の期待値**: フェーズ 3 に「撤退基準」を追加し、NodesSearched が悪化した場合のフォールバック手順（`AspirationUseStageTable = false` への全面リバート等）を明記すること。

**[P2-1] retry 計測フィールドのスレッドセーフティ**
- **対象セクション**: Section 5.5 (retry 計測機能)
- **内容**: `_aspirationRetryCount` と `_aspirationFallbackCount` は通常の int フィールドとして定義されている。Non-Goals に「並列探索との統合」が明記されているため現時点では問題ないが、将来的に並列探索を導入する際にはこれらのカウンタのスレッドセーフティが課題となる。この点は設計上のメモとして記録しておくことが望ましい。
