## Technical Quality Reviewer によるレビュー結果

### 1. 判定 (Decision)

- **Status**: Approve

**判定基準:** P0 が1件以上存在する場合は Request Changes とする。P0 が0件の場合は Approve とする。

### 2. 良い点 (Strengths)

- **stackalloc の適切な活用（セクション 5.1.3）**: OrderMoves で Span + stackalloc を使用し、ヒープアロケーションを排除しつつ、オセロの合法手数上限（最大約 30 手）に対して安全な範囲で使用している。
- **事前確保パターンの採用（セクション 5.1.4）**: FeaturePatternExtractor でパターン種類とサブパターン数が固定であることを活かし、事前確保配列による完全なゼロアロケーションを実現する設計は、ドメイン特性を適切に活用している。
- **MoveInfo 構造体の設計（セクション 5.2.1）**: UnmakeMove に必要な情報を値型の構造体に収め、スタック上に配置することで追加のアロケーションなしに状態保存・復元を実現する設計は、ゲーム探索エンジンの標準的かつ堅実な手法である。
- **テスト戦略の具体性（セクション 8）**: Phase 1・Phase 2 それぞれに対して、単体テスト通過・結果一致検証・GC 定量計測・実対局検証を含む多層的なテスト計画が設計されている。
- **コードベースとの一貫性**: DI コンテナのコンストラクタインジェクション化（5.1.1）は、PvsSearchEngine が既に採用しているパターンとの一貫性を持つ。

### 3. 指摘事項 (Issues)

#### Severity 定義

| Severity | 名称 | 定義 | Author の対応 |
| :--- | :--- | :--- | :--- |
| **P0 (Blocker)** | 修正必須 | 論理的欠陥、仕様漏れ、重大なリスク、回答必須の質問 | 必ず対応 |
| **P1 (Improvement)** | 具体的改善 | 修正内容と期待効果が明確な具体的改善提案 | 原則対応 |
| **P2 (Note)** | 記録のみ | 代替案の提示、将来的な懸念、参考情報 | 対応不要 |

#### 指摘一覧

**P0:**

該当なし

**[P1-1] OrderMoves の改善後もソート結果として新規 List を返却しておりアロケーションが残存**
- **対象セクション**: 5.1.3 OrderMoves の LINQ 排除
- **内容**: LINQ を排除し stackalloc で scores/indices を管理する改善は適切であるが、最終的に `new List<int>(count)` で新規リストを生成して返却しているため、ヒープアロケーションが 1 つ残存している。Phase 2 の MakeMove/UnmakeMove パターン導入後は、呼び出し側でソート済みの moves を in-place で利用する設計が可能である。
- **修正の期待値**: Phase 1 では現行設計で問題ないが、Phase 2 において moves リスト自体を in-place でソートする方式に変更し、戻り値の新規 List アロケーションも排除する旨を記載する。

**[P1-2] AnalyzeCount メソッドの MoveAndReverseUpdater.Update 呼び出しの副作用が不明確**
- **対象セクション**: 5.1.2 MobilityAnalyzer.AnalyzeCount メソッド追加
- **内容**: AnalyzeCount のコード例では `_updater.Update(context, i)` を呼び出しているが、Update が context に副作用（盤面変更）を与えた場合のロールバック処理が記述されていない。現行の Analyze メソッドでは着手可能判定のみ（Mobility ビットの設定）で盤面変更は行わない可能性があるが、Update の副作用の有無を RFC 内で明確にすべきである。
- **修正の期待値**: MoveAndReverseUpdater.Update が着手可能判定時に盤面を変更するか否かを明記し、変更する場合はロールバック処理の設計を追加する。変更しない場合はその旨を仮定として明記する。

**[P2-1] Null Window Search の re-search 発生率に関する可観測性の具体的設計が不足**
- **対象セクション**: 5.2.3 PVS/NegaScout の Null Window Search 実装 / 7.3 可観測性
- **内容**: セクション 7.3 で「re-search 発生回数をログに追加することを検討する」と記載されているが、Move Ordering の品質を継続的に評価するためには re-search 率の計測は重要であり、「検討」ではなく具体的なメトリクス設計（カウンタフィールドの追加、ログ出力フォーマット）まで定義しておくことが望ましい。
