## Approach Reviewer によるレビュー結果

### 1. 判定 (Decision)

- **Status**: Request Changes

**判定基準:** P0 が1件以上存在する場合は Request Changes とする。P0 が0件の場合は Approve とする。

### 2. 良い点 (Strengths)

設計上の重要な判断で妥当と評価できるものを簡潔に記載する。

- 2. 背景・動機: Phase 1/2 の成果を前提条件として明示し、各 Phase の責務分離が明確に論理的根拠をもって説明されている。
- 3. 目的とスコープ: Non-Goals の線引きが具体的かつ合理的であり、SIMD やマルチスレッドといった将来課題を明確に除外している。
- 6. 代替案の検討: 3 つの代替案を比較し、Magic Bitboard を却下する論理的根拠（オセロの裏返し処理との非親和性）が妥当である。
- 5.4.5 実装上の複雑性と段階的導入: 複雑性の高い評価関数差分更新を最後のステップに配置し、Step 1/2 のみでもリリース可能とするリスク軽減策が適切である。
- 9. 実装・リリース計画: 各ステップの依存関係と成果物が明確に定義されており、段階的な検証が可能な構造になっている。

### 3. 指摘事項 (Issues)

#### Severity 定義

| Severity | 名称 | 定義 | Author の対応 |
| :--- | :--- | :--- | :--- |
| **P0 (Blocker)** | 修正必須 | 論理的欠陥、仕様漏れ、重大なリスク、回答必須の質問 | 必ず対応 |
| **P1 (Improvement)** | 具体的改善 | 修正内容と期待効果が明確な具体的改善提案 | 原則対応 |
| **P2 (Note)** | 記録のみ | 代替案の提示、将来的な懸念、参考情報 | 対応不要 |

#### 指摘一覧

**[P0-1] FindFlips のマスク適用方向に論理的欠陥がある**
- **対象セクション**: 5.1.2 ビットボード合法手生成アルゴリズム
- **内容**: `FindFlips` の「左」方向（shift = -1）で `NotHFile` マスクを適用し、「右」方向（shift = 1）で `NotAFile` マスクを適用しているが、マスク適用対象は `opponent` に対して行われている。右方向にシフトして相手石を探す場合、回り込みを防止すべきは「H列の相手石が左シフトで A列に回り込む」ケースであるため、右方向では相手石に `NotHFile` ではなく `NotAFile` マスクを適用する設計意図は一見正しく見えるが、同様のロジックが `ComputeFlippedDirection`（5.1.3）でも使われるため、両者で一貫していることを明確にすべきである。さらに、対角線方向（shift = 9, -9, 7, -7）ではマスクが片側の列のみに適用されているが、対角線方向では両端列の回り込みが発生する可能性があるため、`NotAFile & NotHFile` ではなく片側マスクのみで十分であることの根拠を RFC 内に記載すべきである。
- **修正の期待値**: 各方向のシフトとマスクの対応関係について、回り込み防止の正しさの根拠（各方向でどの列の回り込みが問題になるか）を設計セクションに補足として追記すること。

**[P0-2] MobilityAnalyzer のインターフェース変更が設計と不整合**
- **対象セクション**: 5.1.4 MobilityAnalyzer への統合
- **内容**: RFC のコード例では `Analyze(GameContext context, Disc.Color turn)` のシグネチャを示しているが、現行の `MobilityAnalyzer.Analyze` は `context.Turn` を一時的に変更して復元する副作用ベースの設計であり、DI で注入された `MoveAndReverseUpdater` インスタンスを使用している。RFC のビットボード版は `MoveAndReverseUpdater` への依存を完全に排除し、`GetPlayerOpponent` で直接 ulong を取得する設計に変更しているが、`MoveAndReverseUpdater.Update` は合法手判定以外に着手実行（裏返し反映）も担っており、この依存の除去が既存の `PvsSearchEngine.MakeMove` での `_reverseUpdater.Update(context)` 呼び出しにどう影響するかが記載されていない。
- **修正の期待値**: ビットボード化後の `MoveAndReverseUpdater.Update`（着手実行モード）の位置づけを明確にし、`PvsSearchEngine.MakeMove` から呼ばれる裏返し処理がビットボード版 `ComputeFlipped` + ビットボード演算に置換されるのか、既存の逐次処理を維持するのかを設計セクションに記載すること。

**[P1-1] 性能改善の定量的な検証基準が不明確**
- **対象セクション**: 7.2 スケーラビリティとパフォーマンス
- **内容**: 「同一局面・同一深さでの探索速度を Phase 2 完了時点から 2〜5 倍に改善する」と記載されているが、どの局面・どの深さで計測するか、NPS をどの条件で比較するかが定義されていない。
- **修正の期待値**: ベンチマーク条件（局面、探索深さ、計測回数、NPS の計算方法）を具体的に定義し、Phase 3 の各ステップ完了後に計測すべきメトリクスを 9. 実装・リリース計画 の各ステップの「成果物」に追記すること。

**[P1-2] Phase 3 開始条件の確認方法が不十分**
- **対象セクション**: 3. 目的とスコープ - Phase 3 開始条件
- **内容**: 「Phase 1/2 の PR がマージされていること」が確認方法として記載されているが、Phase 1/2 が同一リポジトリの別ブランチなのか、別 RFC なのか、また具体的な PR 番号やブランチ名への参照がない。
- **修正の期待値**: Phase 1/2 の RFC へのパスまたは PR 番号を明記し、開始条件の確認を具体的にトレースできるようにすること。

**[P2-1] 評価関数差分更新の計算量見積もりの前提が楽観的**
- **対象セクション**: 5.4 評価関数の差分更新
- **内容**: 「影響パターン数はマスにより 3〜8 個程度」としているが、コーナー付近のマスは Edge2X、Corner2X5、Corner3X3 等の大型パターンに多数含まれるため、最悪ケースでの影響パターン数が 8 を超える可能性がある。差分更新のオーバーヘッド（逆引きテーブルのメモリアクセスパターン、キャッシュミス）も考慮すると、フルスキャンに対する高速化倍率は局面に大きく依存する可能性がある。

**[P2-2] `ToMoveList` が `List<int>` を返す点でアロケーションが発生する**
- **対象セクション**: 5.1.2 ビットボード合法手生成アルゴリズム
- **内容**: Phase 1/2 で GC アロケーション削減を徹底した方針と整合性を取るならば、`ToMoveList` が `List<int>` を新規生成する点は Phase 1/2 の設計思想と矛盾する可能性がある。`Span<int>` + `stackalloc` によるゼロアロケーション版も検討に値する。
