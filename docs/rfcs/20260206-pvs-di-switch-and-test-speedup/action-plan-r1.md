# レビュー統合アクションプラン（ラウンド 1）

## 判定
- **Status**: Request Changes
- **P0 件数**: 1 件
- **P1 件数**: 5 件（アクション対象: 5 件）
- **P2 件数**: 4 件（記録のみ）

## 必須対応 (P0)

**[P0-1] MSTest 並列実行時の ZobristTranspositionTable 共有に対する具体的な緩和策の決定**
- **出典**: Security & Risk Reviewer
- **内容**: RFC は TT の Singleton 共有によるテストクラス間の干渉リスクを認識しているが、対策が「Clear するか、独立性を検証し、問題があれば Workers 数を制限する」という曖昧な記述にとどまっている。並列実行を有効化する設計判断であるにもかかわらず、採用する緩和策が未決定であり、非決定的テスト失敗（flaky test）のリスクが残存している。
- **修正方針**: 採用する緩和策を1つに確定し、詳細設計 5.5 に具体的な実装方法を記載する。例: 「各テストクラスの `[ClassInitialize]` で `TranspositionTable.Clear()` を呼び出す」、または「TT を使うテストクラスを `[DoNotParallelize]` 属性で直列実行に固定する」等。

## 推奨対応 (P1) — 上位5件

**[P1-1] 実装計画にタスク間のチェックポイント（ゲート条件）を追記**
- **出典**: Approach Reviewer / Security & Risk Reviewer（統合）
- **内容**: Approach Reviewer は切り戻し手順の欠如を、Security & Risk Reviewer は旧コード削除の不可逆性リスクをそれぞれ指摘している。変更範囲が広い一括実施において、問題発生時の切り戻し判断基準がない。
- **修正方針**: 実装計画のタスク一覧にゲート条件を追記する。具体的には「タスク2完了後: 全テスト PASS を確認」「タスク4完了後: ビルド成功を確認」「タスク8完了後: 全テスト PASS + 実行時間計測」等を追記し、各ゲートで失敗した場合は直前のコミットに revert する方針を明記する。

**[P1-2] DI 切替後の UI 対局検証における具体的な判定基準の定義**
- **出典**: Approach Reviewer / Security & Risk Reviewer（統合）
- **内容**: Approach Reviewer は「正常に動作する」の判定基準が不明確であることを、Security & Risk Reviewer は全オプション ON で問題が発覚した場合の緩和策が不足していることを指摘している。
- **修正方針**: テスト戦略の検証観点に「応答時間が N 秒以内であること」「合法手を返すこと」等の具体的判定基準を追記する。また、応答時間が許容範囲を超えた場合の対処方針（特定オプションの段階的無効化等）を実装計画に追記する。

**[P1-3] depth 削減後のテストアサーション妥当性の検討**
- **出典**: Technical Quality Reviewer
- **内容**: depth を 7→5 に削減した場合、既存テストのアサーション（期待される最善手やノード数の比較条件）が depth=5 でも成立するかの検討が記載されていない。
- **修正方針**: 詳細設計 5.6 に「depth 削減後に実測値でアサーションを更新する。ノード数比較系テストは相対比較（MPC ON < OFF 等）のため depth 変更の影響を受けにくいが、絶対値アサーションがある場合は実測値に更新する」等の方針を追記する。

**[P1-4] FindBestMoverUnitTest 移設時の DI 構成の明確化**
- **出典**: Technical Quality Reviewer
- **内容**: `FindBestMover経由で終盤探索が正常に動作する` テストの移設方針は示されているが、移設先テストが `PvsSearchEngine` を使う DI 構成をどう組み立てるかが未定義である。
- **修正方針**: 詳細設計 5.4 に移設先テストの DI 構成方針を追記する。例: 「`DiProvider` の標準構成をそのまま使用し、`ISearchEngine` は `PvsSearchEngine` として解決される」等。

**[P1-5] 全オプション ON で問題発覚時の段階的無効化手順**
- **出典**: Security & Risk Reviewer
- **内容**: 全オプション ON での本番動作が初めてであり、検証で問題が発覚した場合の具体的な対処方針が不足している。
- **修正方針**: 実装計画またはテスト戦略に「応答時間が許容範囲を超えた場合、MPC → Aspiration Window → TT の順にオプションを無効化して切り分けを行う」等の段階的無効化手順を記載する。

## 記録のみ (P2)

- テスト実行時間の目標値「30秒以下」の根拠を明記しておくと目標の妥当性が検証しやすくなる（出典: Approach Reviewer）
- `ICacheable` インターフェースの削除判断を RFC の段階で確定させておくと実装時の判断ブレを防げる（出典: Security & Risk Reviewer）
- `SearchOptions` のコンストラクタ引数が増えた場合の可読性低下に備え、将来的に Builder パターン等の導入を検討する（出典: Technical Quality Reviewer）
- テスト実行時間の継続的モニタリング（CI での閾値チェック）は将来的な検討事項である（出典: Technical Quality Reviewer）

## 要判断（矛盾する指摘）

該当なし
