## Security & Risk Reviewer によるレビュー結果

### 1. 判定 (Decision)

- **Status**: Request Changes

**判定基準:** P0 が1件以上存在する場合は Request Changes とする。P0 が0件の場合は Approve とする。

### 2. 良い点 (Strengths)

- **横断的関心事**: `ISearchEngine` インターフェースを変更しないことで外部から見た後方互換性を維持する設計判断は、移行リスクを最小化している。
- **詳細設計 5.5**: MSTest 並列実行における `ZobristTranspositionTable` の Singleton 共有リスクを事前に認識し、RFC 内で明示的に言及している。
- **削除対象の依存分析**: Cacher 群が `CachedNegaMax` からのみ参照されていることを確認し、削除の安全性を事前に検証している。
- **テスト移設**: 統合テストの価値を認識し、旧テストファイルの単純な全削除ではなく移設という判断をしている。

### 3. 指摘事項 (Issues)

#### Severity 定義

| Severity | 名称 | 定義 | Author の対応 |
| :--- | :--- | :--- | :--- |
| **P0 (Blocker)** | 修正必須 | 論理的欠陥、仕様漏れ、重大なリスク、回答必須の質問 | 必ず対応 |
| **P1 (Improvement)** | 具体的改善 | 修正内容と期待効果が明確な具体的改善提案 | 原則対応 |
| **P2 (Note)** | 記録のみ | 代替案の提示、将来的な懸念、参考情報 | 対応不要 |

#### 指摘一覧

**[P0-1] MSTest 並列実行時の ZobristTranspositionTable 共有による非決定的テスト失敗リスク**
- **対象セクション**: 5.5 MSTest 並列実行の有効化
- **内容**: RFC は TT の Singleton 共有によるテストクラス間の干渉リスクを認識しているが、対策が「テストクラスごとに TT を Clear するか、テストの独立性を検証し、問題があれば Workers 数を制限する」という曖昧な記述にとどまっている。並列実行を有効化する設計判断であるにもかかわらず、具体的にどの対策を採用するかが未決定のままであり、非決定的テスト失敗（flaky test）という重大なリスクが残存している。
- **修正の期待値**: 採用する緩和策を1つに決定し、その具体的な実装方法を詳細設計に記載する。例えば「各テストクラスの `[ClassInitialize]` で `TranspositionTable.Clear()` を呼び出す」等の具体的な方針を明記する。

**[P1-1] 全オプション ON での本番動作が未検証であるリスクに対する緩和策の不足**
- **対象セクション**: 7.1 スケーラビリティとパフォーマンス
- **内容**: 「全オプション ON での本番動作は初めてとなるため、UI 対局での応答時間を検証する必要がある」と記載されているが、検証で問題が発覚した場合の緩和策（特定オプションの無効化手順、許容応答時間の基準等）が示されていない。
- **修正の期待値**: 検証で応答時間が許容範囲を超えた場合の対処方針（例: 特定オプションの段階的無効化）を実装計画またはテスト戦略に追記する。

**[P1-2] 旧コード削除の不可逆性に対するリスク緩和策の欠如**
- **対象セクション**: 9. 実装・リリース計画
- **内容**: 8ファイルの削除と DI 切替を一括で行うが、問題発生時の切り戻し手順が記載されていない。Git の revert で対応可能ではあるが、タスク間の依存関係が複数あるため、どの段階まで戻すべきかの判断基準がないと混乱を招く。
- **修正の期待値**: 実装計画に「タスク2完了後に全テスト PASS を確認」「タスク4完了後にビルド成功を確認」等のゲート条件を追記し、問題時は直前のコミットに revert する方針を明記する。

**[P2-1] ICacheable インターフェースの削除判断が実装時の調査に委ねられている**
- **対象セクション**: 5.7 Cachers ディレクトリの扱い
- **内容**: `ICacheable` が他から参照されていなければディレクトリごと削除するとあるが、この判断が実装時に委ねられている。RFC の段階で参照調査を完了し、削除可否を確定させておくと実装時の判断ブレを防げる。
