## Security & Risk Reviewer によるレビュー結果

### 1. 判定 (Decision)

- **Status**: Approve

**判定基準:** P0 が1件以上存在する場合は Request Changes とする。P0 が0件の場合は Approve とする。

### 2. 良い点 (Strengths)

- 後方互換性: `ISearchEngine.Search` インターフェースおよび `FindBestMover.Move` の戻り値に変更がなく、外部への影響がないことが明確に分析されている。
- 探索の正確性への影響分析: 対策2（連続パス検出）において、修正が探索結果の品質に悪影響を与えないことの根拠が明確に記述されている。
- フェーズ分割: 3つの対策を独立したフェーズに分割し、各フェーズで単体テストを追加する計画は、段階的なリスク検証を可能にしている。
- Non-Goals の明確化: UI 非同期化を明示的にスコープ外としており、影響範囲の拡大リスクを回避している。

### 3. 指摘事項 (Issues)

#### Severity 定義

| Severity | 名称 | 定義 | Author の対応 |
| :--- | :--- | :--- | :--- |
| **P0 (Blocker)** | 修正必須 | 論理的欠陥、仕様漏れ、重大なリスク、回答必須の質問 | 必ず対応 |
| **P1 (Improvement)** | 具体的改善 | 修正内容と期待効果が明確な具体的改善提案 | 原則対応 |
| **P2 (Note)** | 記録のみ | 代替案の提示、将来的な懸念、参考情報 | 対応不要 |

#### 指摘一覧

P0: 該当なし

**[P1-1] 対策3 の `_usePatternIncremental` フラグの状態管理リスク**
- **対象セクション**: 5.3 対策3
- **内容**: `_usePatternIncremental` フィールドが `Search` メソッドで設定され、`MakeMove`/`UnmakeMove` で参照される設計であるが、`SearchTimeoutException` 発生時にフラグが不整合な状態で残るリスクについて、例外ハンドラ内の処理に言及はあるが、フラグ自体のリセットが明記されていない。
- **修正の期待値**: `Search` メソッドの `finally` ブロックまたは `SearchTimeoutException` ハンドラ内で `_usePatternIncremental` を `false` にリセットする処理を設計に追記すること。

**[P1-2] 対策2 の連続パス検出において `Evaluate` が返す値の符号に関する確認の欠如**
- **対象セクション**: 5.2 対策2
- **内容**: 連続パス時に `return Evaluate(context)` を呼び出すが、`Pvs` メソッドでは再帰呼び出し時に `-Pvs(...)` と符号を反転している。連続パス時の `Evaluate` の戻り値が現在のプレイヤー視点で正しい符号であるかの確認が RFC 上で明示されていない。
- **修正の期待値**: `Evaluate(context)` が現在の `context.Turn` 視点の評価値を返すことを RFC 内で明記し、符号の正当性を確認した旨を記載すること。

**[P2-1] 対策1 と対策2 の組み合わせにおける終盤局面のエッジケース**
- **対象セクション**: 5.1 対策1, 5.2 対策2
- **内容**: 残り空きマス数が1〜2の極端な終盤局面では、対策1 により depth=1〜2 で探索が開始される。この場合、対策2 の連続パス検出が depth の浅さとどのように相互作用するかについて、明示的な分析がない。実害はないと思われるが、エッジケースとしてテスト戦略に含めることが望ましい。

**[P2-2] Phase 3 最適化への依存関係に対するフォールバック未定義**
- **対象セクション**: 4. 前提条件・依存関係
- **内容**: Phase 3 最適化ブランチのマージが前提条件として記載されているが、Phase 3 のマージが遅延した場合の対応方針が定義されていない。本 RFC の3つの対策は Phase 3 の実装に直接依存する箇所（ビットボード合法手生成等）があるため、Phase 3 未マージ時には本修正を適用できない。
