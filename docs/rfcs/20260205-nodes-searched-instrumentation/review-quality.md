## Technical Quality Reviewer によるレビュー結果

### 1. 判定 (Decision)

- **Status**: Request Changes

**判定基準:** P0 が1件以上存在する場合は Request Changes とする。P0 が0件の場合は Approve とする。

### 2. 良い点 (Strengths)

- **5.2 カウント方針**: インクリメント箇所を `Pvs()` メソッド先頭の 1 箇所に限定しており、カウント漏れや二重カウントのリスクを構造的に排除している。
- **5.2 TT Probe ヒット時の扱い**: TT ヒットノードを「探索したが早期に打ち切れた」として 1 ノードにカウントする方針が明確で、TT 効果の定量評価に適した設計である。
- **6. 代替案の検討**: 案 A〜E の比較が具体的な長所・短所とともに記述されており、YAGNI に基づく選定理由および既存フィールドパターン（`_bestMove`, `_currentDepth`）との一貫性が明確である。
- **5.1 後方互換性**: コンストラクタのデフォルト値により `LegacySearchEngine` 等の既存呼び出し元への影響を排除しており、実際のコードベースと整合している。
- **5.2 Aspiration Window 再探索時のカウント方針**: retry・確定・フォールバックの全パターンで累積する方針が明確に記述されており、「実際に CPU 時間を消費する探索処理」という根拠も妥当である。

### 3. 指摘事項 (Issues)

#### Severity 定義

| Severity | 定義 |
| :--- | :--- |
| **P0 (Blocker)** | 修正必須。論理的欠陥、仕様漏れ、重大なリスク、回答必須の質問 |
| **P1 (Nit)** | 提案。より良い手法、軽微な懸念、参考情報 |

#### 指摘一覧

**[P0-1] RFC 擬似コードと既存 `Pvs()` メソッドの制御フローの不整合**
- **対象セクション**: 5.2 PvsSearchEngine へのカウンタ導入 / 実装の詳細
- **内容**: RFC の擬似コードでは `_nodesSearched++` → 終了条件チェック（`remainingDepth == 0`）の順であるが、既存の `PvsSearchEngine.cs` の `Pvs()` メソッドでは終了条件チェックがメソッド先頭（354〜359行目）にある。RFC のコードをそのまま適用するには既存コードの制御フローを変更する必要があるが、この構造変更への言及がない。また、葉ノード（`remainingDepth == 0` で `Evaluate` を呼ぶノード）をカウント対象に含むか否かが暗黙的であり、明示されていない。
- **修正の期待値**: 既存 `Pvs()` の制御フロー（終了条件 → TT Probe → 合法手展開）に対する `_nodesSearched++` の正確な挿入位置を示すこと。葉ノードをカウント対象に含む旨を明示的に記載すること。

**[P0-2] パスノードの再帰呼び出しにおけるカウント方針の未定義**
- **対象セクション**: 5.2 PvsSearchEngine へのカウンタ導入 / カウント方針
- **内容**: 既存の `Pvs()` メソッドにはパス処理（合法手が 0 の場合に `BoardAccessor.Pass` → 再帰呼び出し）が存在する（432〜436行目）。`Pvs()` 先頭でインクリメントする方針ではパスノードもカウント対象となるが、RFC ではパスノードの扱いに一切言及がない。パスノードは盤面の展開（新しい着手）を伴わないため、カウント対象とすべきか否かは設計判断が必要である。
- **修正の期待値**: パスノードをカウント対象に含むか否かを「カウント方針」セクションに明示的に記載すること。含む場合はその理由を、含まない場合はインクリメント位置の調整方法を示すこと。

**[P1-1] `Console.WriteLine` のテスト時の扱いが未定義**
- **対象セクション**: 5.3 探索ログの出力 / 8. テスト戦略
- **内容**: `Console.WriteLine` による標準出力はテスト実行時にもノイズとして出力される。テスト観点「深さごとの累積」の検証ではログ出力のパースが必要になる可能性があるが、その手法が記載されていない。
- **修正の期待値**: テスト時の `Console.WriteLine` の扱い（無視するか、`StringWriter` でキャプチャするか等）を検証方法に記載すること。

**[P1-2] `RootSearch()` 内で合法手が 0 の場合に `Evaluate` が呼ばれるがカウント対象外**
- **対象セクション**: 5.2 PvsSearchEngine へのカウンタ導入 / カウント方針
- **内容**: `RootSearch()` の 242〜244 行目では合法手が 0 の場合に `Evaluate(context)` を呼び出して `SearchResult` を返すが、このノードは `Pvs()` を経由しないためカウントされない。RFC の「ルート局面自体は 1 ノードとしてカウントしない」という仮定と整合するが、評価関数呼び出しが発生する点でカウント定義（「評価関数を呼び出す時点」）と矛盾する。
- **修正の期待値**: `RootSearch()` 内の評価関数呼び出しがカウント対象外である理由を補足するか、カウント定義を「`Pvs()` メソッドの呼び出し回数」に限定する形で整理すること。

**[P1-3] スレッドセーフティの前提が横断的関心事セクションに未記載**
- **対象セクション**: 7.1 スケーラビリティとパフォーマンス
- **内容**: 代替案の検討（案 A）では「スレッドセーフではないが、現状シングルスレッド探索のため問題にならない」と記載があるが、横断的関心事セクションではこの前提が明示されていない。
- **修正の期待値**: 横断的関心事セクションにシングルスレッド前提であること、および将来の並列化時に `Interlocked.Increment` への移行が必要な旨を追記すること。
