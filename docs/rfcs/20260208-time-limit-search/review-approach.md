## Approach Reviewer によるレビュー結果

### 1. 判定 (Decision)

- **Status**: Request Changes

**判定基準:** P0 が1件以上存在する場合は Request Changes とする。P0 が0件の場合は Approve とする。

### 2. 良い点 (Strengths)

- **セクション 2 (背景・動機)**: 現行の固定深さ制御の問題点を具体的なシナリオで説明しており、本 RFC の必然性が明確に示されている。
- **セクション 5.1 (全体アーキテクチャ)**: 2 レイヤー構成により粗い粒度の制御と細かい粒度の制御を分離しており、各レイヤーの責務が明確である。
- **セクション 3 (Non-Goals)**: ポンダリング、秒読み、CancellationToken、並列探索を明示的にスコープ外としており、スコープの境界が明快である。
- **セクション 6 (代替案の検討)**: 例外方式 vs フラグ方式、時間推定方式 vs NPS 推定方式をそれぞれ比較検討しており、設計判断の根拠が十分に記述されている。
- **セクション 7.3 (後方互換性)**: nullable パラメータとデフォルト値により既存コードへの影響がゼロであることが保証されている。

### 3. 指摘事項 (Issues)

#### Severity 定義

| Severity | 名称 | 定義 | Author の対応 |
| :--- | :--- | :--- | :--- |
| **P0 (Blocker)** | 修正必須 | 論理的欠陥、仕様漏れ、重大なリスク、回答必須の質問 | 必ず対応 |
| **P1 (Improvement)** | 具体的改善 | 修正内容と期待効果が明確な具体的改善提案 | 原則対応 |
| **P2 (Note)** | 記録のみ | 代替案の提示、将来的な懸念、参考情報 | 対応不要 |

#### 指摘一覧

**[P0-1] 終盤完全読み切りモード（depth=99）における時間制御の未定義**
- **対象セクション**: 5.6.3 FindBestMover との統合 / 3. 目的とスコープ
- **内容**: `FindBestMover` は `TurnCount >= EndgameTurnThreshold` の場合に `depth = EndgameDepth`（99）で完全読み切りを行うが、この完全読み切りモードに対して `timeLimitMs` がどのように適用されるかが未定義である。セクション 5.6.2 では「完全読み切りモードの時間制御については将来の課題とし、本 RFC では通常探索時の配分を実装する」と記載されているが、セクション 5.6.3 のコード例では終盤モードでも `timeLimitMs` が設定されており矛盾がある。終盤で depth=99 に `timeLimitMs` を適用した場合、レイヤー 1 の分岐係数 3 倍推定が完全読み切りの特性と合致せず、不適切な打ち切りが発生する可能性がある。
- **修正の期待値**: 終盤完全読み切りモードにおける時間制御の方針を明確に記載すること。選択肢として (a) 終盤モードでは `timeLimitMs` を適用しない、(b) 終盤モード用の別の打ち切り戦略を記述する、(c) 本 RFC では終盤モードへの `timeLimitMs` 適用を Non-Goals に追記しコード例から終盤パスの `timeLimitMs` 設定を除外する、のいずれかを採用すること。

**[P1-1] TimeAllocator が自手番の残り手数のみを考慮しパスの影響を十分にモデル化していない**
- **対象セクション**: 5.6.1 TimeAllocator クラス / EstimateRemainingMoves
- **内容**: `EstimateRemainingMoves` は `(MaxTurns - turnCount + 1) / 2` で自手番の残り手数を推定しているが、オセロではパスにより一方が連続して手番を得る局面が存在する。パスが発生すると自分の手番数が増減し、配分が不正確になる。コメントに「やや多めに見積もる」とあるが、具体的にどの程度の余裕を持たせているかが不明確である。
- **修正の期待値**: パスの影響について想定される最悪ケース（例: 連続パスによる手番偏り）を記載し、現在の推定式がその範囲で安全に機能することを説明に追記すること。

**[P1-2] 分岐係数 3 倍の根拠がオセロの特性と整合しているか要確認**
- **対象セクション**: 5.5.2 反復深化ループの時間制御 / 6. 代替案の検討
- **内容**: 分岐係数 3 倍の根拠として「オセロの平均分岐係数（約 10）と Alpha-Beta の理想的枝刈り（分岐係数の平方根）」と記載されているが、sqrt(10) は約 3.16 であり概ね妥当である。ただし MPC 有効時には実効分岐係数がさらに低下するため、3 倍は過大推定（保守的すぎ）になる可能性が高い。保守的すぎる推定は時間の無駄遣いにつながる。
- **修正の期待値**: MPC 有効時の実効分岐係数についての想定値（例: 2 倍程度）を記載し、将来的に MPC ON/OFF で分岐係数推定を切り替える拡張の可能性に言及すること。

**[P2-1] SafetyMarginRatio の 5% が十分かどうかの検証計画が未記載**
- **対象セクション**: 5.6.1 TimeAllocator クラス
- **内容**: `SafetyMarginRatio = 0.05` は全体の 5% を安全マージンとして確保するが、この値が実戦で十分かどうかの検証計画が明示されていない。持ち時間が短い対局（例: 1 分）では 5% = 3 秒であり、OS のスケジューリング遅延や GC の影響を考慮すると不足する可能性がある。

**[P2-2] MaxDepth の扱いが TimeLimitMs 設定時に未定義**
- **対象セクション**: 5.5.2 反復深化ループの時間制御
- **内容**: `TimeLimitMs` を設定した場合でもループは `options.MaxDepth` まで回るが、`TimeLimitMs` 使用時に `MaxDepth` のデフォルト値がどのように影響するかの説明がない。`MaxDepth` のデフォルト値が低い場合、時間に余裕があっても探索が浅く終了する可能性がある。`TimeLimitMs` 設定時に `MaxDepth` のデフォルトを十分大きな値にするかどうか検討が望ましい。
